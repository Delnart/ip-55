<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–£–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å—å–∫–∏–π –ø–æ–º—ñ—á–Ω–∏–∫</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f9fafb; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const API_BASE = '/api';

        // --- ICONS ---
        const Icons = {
            Home: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Calendar: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" strokeWidth="2"/><path strokeWidth="2" d="M16 2v4M8 2v4M3 10h18"/></svg>,
            Users: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4" strokeWidth="2"/><path strokeWidth="2" d="M23 21v-2a4 4 0 0 0-3-3.87"/><path strokeWidth="2" d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
            Book: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path strokeWidth="2" d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
            Clipboard: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="2" strokeWidth="2"/></svg>,
            ArrowLeft: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>,
            Settings: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3" strokeWidth="2"/><path strokeWidth="2" d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            Trash: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0 1 16.138 21H7.862a2 2 0 0 1-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v3M4 7h16"/></svg>
        };

        // --- COMPONENTS ---

        function SubjectView({ subject, user, onNavigate, onBack }) {
            return (
                <div className="min-h-screen bg-gray-50 pb-20 animate-in">
                    <div className="bg-white p-4 shadow-sm sticky top-0 z-10 flex items-center gap-3">
                        <button onClick={onBack} className="p-2 -ml-2 text-gray-600 rounded-full active:bg-gray-100"><Icons.ArrowLeft /></button>
                        <h1 className="font-bold text-xl truncate">{subject.name}</h1>
                    </div>
                    <div className="p-4 space-y-4">
                        <div className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100">
                            <h3 className="text-gray-400 text-xs font-bold uppercase mb-1">–õ–µ–∫—Ç–æ—Ä</h3>
                            <p className="font-medium text-lg mb-3">{subject.teacherLecture || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</p>
                            <h3 className="text-gray-400 text-xs font-bold uppercase mb-1">–ü—Ä–∞–∫—Ç–∏–∫</h3>
                            <p className="font-medium text-lg">{subject.teacherPractice || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</p>
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                            <button onClick={() => onNavigate('queue', subject)} className="p-4 bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition">
                                <div className="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center text-purple-600"><Icons.Users /></div>
                                <span className="font-bold text-gray-700">–ß–µ—Ä–≥–∞</span>
                            </button>
                            <button onClick={() => onNavigate('topics', subject)} className="p-4 bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col items-center justify-center gap-2 active:scale-95 transition">
                                <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-green-600"><Icons.Book /></div>
                                <span className="font-bold text-gray-700">–¢–µ–º–∏</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function QueueView({ subject, user, onBack, isAdmin }) {
            const [queue, setQueue] = useState(null);
            const [selectedSlot, setSelectedSlot] = useState(null);
            const [labNum, setLabNum] = useState('');
            const STATUSES = {
                waiting: { color: 'bg-white border-gray-200', icon: '' },
                preparing: { label: '–ì–æ—Ç—É—î—Ç—å—Å—è', color: 'bg-yellow-50 border-yellow-300 text-yellow-700', icon: '‚è∞' },
                defending: { label: '–ó–¥–∞—î', color: 'bg-green-50 border-green-300 text-green-700', icon: '‚ñ∂Ô∏è' },
                completed: { label: '–ó–¥–∞–≤', color: 'bg-blue-50 border-blue-300 text-blue-700', icon: '‚úÖ' },
                failed: { label: '–ù–µ –∑–¥–∞–≤', color: 'bg-red-50 border-red-300 text-red-700', icon: '‚ùå' }
            };

            const fetchQueue = async () => {
                try {
                    let res = await fetch(`${API_BASE}/queues/subject/${subject._id}`);
                    let data = await res.json();
                    if (!data) {
                        res = await fetch(`${API_BASE}/queues`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ subjectId: subject._id }) });
                        data = await res.json();
                    }
                    setQueue(data);
                } catch(e) { console.error(e); }
            };

            useEffect(() => { fetchQueue(); const i = setInterval(fetchQueue, 3000); return () => clearInterval(i); }, []);

            const handleJoin = async (slot) => {
                if(!labNum) return alert("–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó");
                const res = await fetch(`${API_BASE}/queues/join`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ queueId: queue._id, telegramId: user.id, labNumber: parseInt(labNum), position: slot })
                });
                const data = await res.json();
                if(data.detail) alert(data.detail);
                else { setSelectedSlot(null); setLabNum(''); fetchQueue(); }
            };

            const changeStatus = async (uid, st) => {
                await fetch(`${API_BASE}/queues/status`, {
                    method: 'PATCH', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ queueId: queue._id, userId: uid, status: st, adminId: user.id })
                });
                fetchQueue(); setSelectedSlot(null);
            };

            const toggleQueue = async () => {
                await fetch(`${API_BASE}/queues/toggle`, {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ queueId: queue._id, adminId: user.id })
                });
                fetchQueue();
            }

            if (!queue) return <div className="p-10 text-center">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>;

            return (
                <div className="min-h-screen bg-gray-50 pb-20 animate-in">
                    <div className="bg-white p-4 sticky top-0 z-20 shadow-sm flex justify-between items-center">
                        <div className="flex items-center gap-2">
                            <button onClick={onBack}><Icons.ArrowLeft /></button>
                            <div>
                                <h2 className="font-bold leading-none">{subject.name}</h2>
                                <span className={`text-xs font-bold ${queue.isActive ? 'text-green-500' : 'text-red-500'}`}>
                                    {queue.isActive ? 'üü¢ –í—ñ–¥–∫—Ä–∏—Ç–æ' : 'üî¥ –ó–∞–∫—Ä–∏—Ç–æ'}
                                </span>
                            </div>
                        </div>
                        {isAdmin && <button onClick={toggleQueue} className="text-xs bg-gray-100 px-3 py-1 rounded-lg font-bold border">
                            {queue.isActive ? '–ó–∞–∫—Ä–∏—Ç–∏' : '–í—ñ–¥–∫—Ä–∏—Ç–∏'}
                        </button>}
                    </div>

                    <div className="p-3 grid grid-cols-3 gap-2">
                        {Array.from({ length: 31 }, (_, i) => i + 1).map(slot => {
                            const entry = queue.entries.find(e => e.position === slot);
                            const style = entry ? STATUSES[entry.status].color : 'border-dashed border-gray-300 bg-gray-50';
                            return (
                                <div key={slot} onClick={() => setSelectedSlot({ slot, entry })}
                                    className={`relative min-h-[100px] rounded-xl border-2 flex flex-col items-center justify-center p-1 transition-all active:scale-95 cursor-pointer ${style}`}>
                                    <span className="absolute top-1 left-2 text-[10px] text-gray-400 font-bold">#{slot}</span>
                                    {entry ? (
                                        <>
                                            <div className="w-8 h-8 rounded-full bg-white flex items-center justify-center text-xs font-bold mb-1 shadow-sm">{entry.user?.fullName?.[0]}</div>
                                            <span className="text-[10px] font-bold text-center leading-tight line-clamp-2">{entry.user?.fullName}</span>
                                            <div className="mt-1 flex items-center gap-1 bg-white/60 px-1.5 rounded text-[10px] font-bold">
                                                –õ–∞–± {entry.labNumber} {STATUSES[entry.status].icon}
                                            </div>
                                        </>
                                    ) : <span className="text-2xl text-gray-300">+</span>}
                                </div>
                            );
                        })}
                    </div>

                    {selectedSlot && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" onClick={() => setSelectedSlot(null)}>
                            <div className="bg-white w-full max-w-xs rounded-2xl p-5" onClick={e => e.stopPropagation()}>
                                <h3 className="text-xl font-bold mb-2">–ú—ñ—Å—Ü–µ #{selectedSlot.slot}</h3>
                                {!selectedSlot.entry ? (
                                    <>
                                        <p className="text-gray-500 text-sm mb-3">–í–≤–µ–¥—ñ—Ç—å –Ω–æ–º–µ—Ä –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó:</p>
                                        <input type="number" className="w-full bg-gray-100 p-3 rounded-xl mb-4 text-center font-bold text-lg" 
                                            value={labNum} onChange={e => setLabNum(e.target.value)} autoFocus placeholder="‚Ññ" />
                                        <button onClick={() => handleJoin(selectedSlot.slot)} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg">–ó–∞–π–Ω—è—Ç–∏</button>
                                    </>
                                ) : (
                                    <>
                                        <p className="font-bold text-center text-lg mb-4">{selectedSlot.entry.user?.fullName}</p>
                                        {isAdmin ? (
                                            <div className="grid grid-cols-2 gap-2">
                                                {Object.entries(STATUSES).filter(([k]) => k !== 'waiting').map(([k, v]) => (
                                                    <button key={k} onClick={() => changeStatus(selectedSlot.entry.userId, k)} className={`p-2 rounded-lg text-xs font-bold border ${v.color}`}>
                                                        {v.icon} {v.label}
                                                    </button>
                                                ))}
                                                <button onClick={async () => {
                                                    await fetch(`${API_BASE}/queues/kick`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ queueId: queue._id, targetUserId: selectedSlot.entry.userId, adminTgId: user.id }) });
                                                    fetchQueue(); setSelectedSlot(null);
                                                }} className="col-span-2 bg-red-100 text-red-600 py-2 rounded-lg font-bold">–í–∏–¥–∞–ª–∏—Ç–∏ –∑ —á–µ—Ä–≥–∏</button>
                                            </div>
                                        ) : selectedSlot.entry.user?.telegramId === user?.id && (
                                            <button onClick={async () => {
                                                await fetch(`${API_BASE}/queues/leave`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ queueId: queue._id, telegramId: user.id }) });
                                                fetchQueue(); setSelectedSlot(null);
                                            }} className="w-full bg-red-100 text-red-600 py-3 rounded-xl font-bold">–í–∏–π—Ç–∏ –∑ —á–µ—Ä–≥–∏</button>
                                        )}
                                    </>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function Schedule() {
            const [schedule, setSchedule] = useState(null);
            const [week, setWeek] = useState(1);

            useEffect(() => { fetch(`${API_BASE}/schedule`).then(r => r.json()).then(setSchedule); }, []);

            if (!schedule) return <div className="p-10 text-center">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>;

            const weekKey = week === 1 ? 'scheduleFirstWeek' : 'scheduleSecondWeek';
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            const dayNames = { Monday: '–ü–æ–Ω–µ–¥—ñ–ª–æ–∫', Tuesday: '–í—ñ–≤—Ç–æ—Ä–æ–∫', Wednesday: '–°–µ—Ä–µ–¥–∞', Thursday: '–ß–µ—Ç–≤–µ—Ä', Friday: "–ü'—è—Ç–Ω–∏—Ü—è" };

            return (
                <div className="p-4 pb-24 animate-in">
                    <div className="flex bg-gray-200 p-1 rounded-xl mb-6">
                        <button onClick={() => setWeek(1)} className={`flex-1 py-2 rounded-lg font-bold text-sm transition ${week === 1 ? 'bg-white shadow-sm' : 'text-gray-500'}`}>1 –¢–∏–∂–¥–µ–Ω—å</button>
                        <button onClick={() => setWeek(2)} className={`flex-1 py-2 rounded-lg font-bold text-sm transition ${week === 2 ? 'bg-white shadow-sm' : 'text-gray-500'}`}>2 –¢–∏–∂–¥–µ–Ω—å</button>
                    </div>
                    <div className="space-y-6">
                        {days.map(dayCode => {
                            const dayData = schedule[weekKey].find(d => d.day === dayCode);
                            if (!dayData?.pairs?.length) return null;
                            return (
                                <div key={dayCode}>
                                    <h3 className="text-gray-400 font-bold uppercase text-xs mb-2 pl-1">{dayNames[dayCode]}</h3>
                                    <div className="space-y-3">
                                        {dayData.pairs.map((pair, idx) => {
                                            const isLec = pair.type.includes('–õ–µ–∫');
                                            return (
                                                <div key={idx} className={`p-4 rounded-xl border-l-4 ${isLec ? 'border-purple-500' : 'border-orange-500'} bg-white shadow-sm flex gap-4`}>
                                                    <div className="flex flex-col items-center justify-center min-w-[50px] border-r border-gray-100 pr-4">
                                                        <span className="font-bold text-gray-900 text-sm">{pair.time.substring(0, 5)}</span>
                                                    </div>
                                                    <div>
                                                        <span className={`text-[10px] px-2 py-0.5 rounded font-bold uppercase ${isLec ? 'bg-purple-100 text-purple-700' : 'bg-orange-100 text-orange-700'}`}>{pair.type}</span>
                                                        <h4 className="font-bold text-gray-800 leading-tight mt-1 mb-1">{pair.name}</h4>
                                                        <p className="text-xs text-gray-500">üë®‚Äçüè´ {pair.teacherName}</p>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        }

        function Home({ user, onNavigate, isAdmin }) {
            const [subjects, setSubjects] = useState([]);
            const [isEditing, setIsEditing] = useState(false);
            const [newSub, setNewSub] = useState({ name: '', teacherLecture: '', teacherPractice: '' });

            const load = () => fetch(`${API_BASE}/subjects`).then(r => r.json()).then(setSubjects);
            useEffect(() => { load(); }, []);

            const add = async () => {
                await fetch(`${API_BASE}/subjects`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(newSub) });
                setIsEditing(false); load();
            };

            const del = async (id) => {
                if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')) { await fetch(`${API_BASE}/subjects/${id}`, { method: 'DELETE' }); load(); }
            };

            return (
                <div className="p-4 pb-24 animate-in">
                    <div className="flex justify-between items-center mb-6 pt-2">
                        <div>
                            <h1 className="text-2xl font-bold">–ü—Ä–∏–≤—ñ—Ç, {user?.firstName}!</h1>
                            <p className="text-gray-500 text-sm">–¢–≤–æ—ó –ø—Ä–µ–¥–º–µ—Ç–∏</p>
                        </div>
                        {isAdmin && <button onClick={() => setIsEditing(!isEditing)} className="p-2 bg-gray-100 rounded-full"><Icons.Settings /></button>}
                    </div>

                    {isEditing && (
                        <div className="bg-white p-4 rounded-xl shadow-lg mb-6 border border-blue-100">
                            <h3 className="font-bold mb-3">–î–æ–¥–∞—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç</h3>
                            <input placeholder="–ù–∞–∑–≤–∞" className="w-full p-2 bg-gray-50 rounded mb-2 border" value={newSub.name} onChange={e => setNewSub({...newSub, name: e.target.value})} />
                            <input placeholder="–õ–µ–∫—Ç–æ—Ä" className="w-full p-2 bg-gray-50 rounded mb-2 border" value={newSub.teacherLecture} onChange={e => setNewSub({...newSub, teacherLecture: e.target.value})} />
                            <input placeholder="–ü—Ä–∞–∫—Ç–∏–∫" className="w-full p-2 bg-gray-50 rounded mb-2 border" value={newSub.teacherPractice} onChange={e => setNewSub({...newSub, teacherPractice: e.target.value})} />
                            <button onClick={add} className="w-full bg-blue-600 text-white py-2 rounded font-bold">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                        </div>
                    )}

                    <div className="space-y-3">
                        {subjects.map(sub => (
                            <div key={sub._id} onClick={() => onNavigate('subject', sub)} className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 active:scale-[0.98] transition-transform flex justify-between items-center">
                                <div>
                                    <h3 className="font-bold text-gray-800">{sub.name}</h3>
                                    <p className="text-xs text-gray-500 mt-1">üéì {sub.teacherLecture}</p>
                                </div>
                                <div className="flex items-center gap-2">
                                    {isEditing && <button onClick={(e) => {e.stopPropagation(); del(sub._id)}} className="text-red-400 p-2"><Icons.Trash /></button>}
                                    <div className="w-8 h-8 bg-gray-50 rounded-full flex items-center justify-center"><svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        function App() {
            const [view, setView] = useState('home');
            const [stack, setStack] = useState([]);
            const [user, setUser] = useState(null);
            const ADMIN_IDS = [1876094081,1117478810]; // –î–æ–¥–∞–π —Å—é–¥–∏ —Å–≤—ñ–π ID –¥–ª—è –∞–¥–º—ñ–Ω-–ø—Ä–∞–≤

            useEffect(() => {
                const tg = window.Telegram?.WebApp;
                if (tg) {
                    tg.ready(); tg.expand();
                    const u = tg.initDataUnsafe?.user;
                    if(u) {
                        setUser({ id: u.id, firstName: u.first_name, username: u.username });
                        fetch(`${API_BASE}/users/update`, { method: 'POST', body: JSON.stringify({ telegramId: u.id, fullName: `${u.first_name} ${u.last_name || ''}`, username: u.username }) });
                    }
                }
            }, []);

            const navigate = (v, d) => setStack([...stack, { view: v, data: d }]);
            const back = () => setStack(stack.slice(0, -1));
            const current = stack.length > 0 ? stack[stack.length - 1] : { view };
            const isAdmin = user && ADMIN_IDS.includes(user.id);

            const render = () => {
                switch(current.view) {
                    case 'home': return <Home user={user} onNavigate={navigate} isAdmin={isAdmin} />;
                    case 'schedule': return <Schedule />;
                    case 'homework': return <div className="p-10 text-center">–î–æ–º–∞—à–∫–∞ –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ...</div>;
                    case 'subject': return <SubjectView subject={current.data} user={user} onNavigate={navigate} onBack={back} />;
                    case 'queue': return <QueueView subject={current.data} user={user} onBack={back} isAdmin={isAdmin} />;
                    case 'topics': return <div className="p-10 text-center text-gray-500"><button onClick={back}>–ù–∞–∑–∞–¥</button><br/><br/>–¢–µ–º–∏ –≤ —Ä–æ–∑—Ä–æ–±—Ü—ñ...</div>;
                    default: return <Home user={user} onNavigate={navigate} isAdmin={isAdmin} />;
                }
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-gray-50 font-sans text-gray-900">
                    {render()}
                    {stack.length === 0 && (
                        <div className="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around p-2 pb-6 z-50">
                            <button onClick={() => setView('home')} className={`flex flex-col items-center p-2 w-16 rounded-xl transition ${view === 'home' ? 'text-blue-600 bg-blue-50' : 'text-gray-400'}`}><Icons.Home /><span className="text-[10px] font-bold mt-1">–ü—Ä–µ–¥–º–µ—Ç–∏</span></button>
                            <button onClick={() => setView('schedule')} className={`flex flex-col items-center p-2 w-16 rounded-xl transition ${view === 'schedule' ? 'text-blue-600 bg-blue-50' : 'text-gray-400'}`}><Icons.Calendar /><span className="text-[10px] font-bold mt-1">–†–æ–∑–∫–ª–∞–¥</span></button>
                            <button onClick={() => setView('homework')} className={`flex flex-col items-center p-2 w-16 rounded-xl transition ${view === 'homework' ? 'text-blue-600 bg-blue-50' : 'text-gray-400'}`}><Icons.Clipboard /><span className="text-[10px] font-bold mt-1">–î–ó</span></button>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>